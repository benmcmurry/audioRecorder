<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="mobile-web-app-capable" content="yes">
    <meta id="theme-color" name="theme-color" content="#fff">
    <title>ELC Audio Recorder</title>
    <link rel="stylesheet" href="style.css" />
    <script src="jquery.js"></script>

    <script type="text/javascript">
        var testAudio;
        var testMicrophone = [];
        $("document").ready(function() {
            navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;

            testAudio = document.querySelector("#test");
            $("#test_record").on("click", testStartRecording);

        });

        function testRecord(stream) {
            // testAudio.controls = true;
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.start(10);
            var url = window.URL || window.webkitURL;
            console.log(testAudio);
            // testAudio.src = url ? url.createObjectURL(stream) : stream;
            // testAudio.play();
            mediaRecorder.ondataavailable = function(e) {
                testMicrophone.push(e.data);
            }
            mediaRecorder.onstop = function() {
                var blob = new Blob(testMicrophone, {
                    type: "audio/webm",
                    name: "myRecording.webm"
                });
                testMicrophone = [];
                var audioURL = window.URL.createObjectURL(blob);
                testAudio.src = audioURL;
                console.log("url: " + audioURL);
            }
        }

        function testStartRecording() {
            // this sets a timer before the prepare timer starts


            $("#test_record").show();

            //this is a time to wait before recording begins
            navigator.getUserMedia({
                "audio": true
            }, testRecord, errorCallback);
            console.log("start recording");


            (function() {
                setTimeout(function() {

                    console.log("stop recording");
                    testStopRecording();
                }, 10000);

            })();
        }


        function testStopRecording() {
            console.log("stop recording");
            mediaRecorder.stop();
            testAudio.controls = false;
        }
    </script>
</head>

<body>
    <audio id='test' autoplay></audio>
    <a id='test_record'>Test Microphone</a>
</body>

</html>